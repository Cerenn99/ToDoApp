@model IEnumerable<WebApplication_todo.Models.TodoItem>

@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}




<h2>My Tasks</h2>


<table class="table">
    <tr>
        <th>

            @Html.DisplayNameFor(model => model.Title)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.CreateDate)
        </th>

        <th>
            @Html.DisplayNameFor(model => model.Detail)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Priority)
        </th>
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>
                @Html.CheckBoxFor(modelItem => item.IsCompleted, new {id=item.Id })
                @Html.DisplayFor(modelItem => item.Title)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.CreateDate)
            </td>

            <td>
                @Html.DisplayFor(modelItem => item.Detail)
            </td>
            <td>
                @Html.DisplayFor(modelItem => item.Priority)
            </td>
            <td>
                @Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
                @Html.ActionLink("Details", "Details", new { id = item.Id }) |
                @Html.ActionLink("Delete", "Delete", new { id = item.Id })
            </td>
        </tr>
    }

</table>







<h2>Completed Items</h2>

<ul>
    @foreach (var item in Model)
    {
        if (item.IsCompleted)
        {
            <li>@item.Title - Completed: @item.CreateDate.ToShortDateString()</li>
        }

    }
</ul>





<div>
    <a href="@Url.Action("Create")" asp-action="Create" class="btn btn-primary">Add a New Task</a>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>

<script>
    $(document).ready(function () {
        $("input[type=checkbox]").change(function (e) {
            console.log(e.target.checked, e.target.id)
            $.ajax({
                url: "/TodoItems/UpdateCompleted",
                method: "POST",
                data: { isCompleted: e.target.checked, id: e.target.id },
                success: function (response) {
                    console.log(`${e.target.id} Checked status updated with ${JSON.stringify(response)} `)
                },
                error: function (error) {
                    console.error("Error:", error);
                },
            });
        });
    });
</script>